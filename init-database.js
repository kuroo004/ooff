const sqlite3 = require('sqlite3').verbose();
const path = require('path');

// Create database file
const dbPath = path.join(__dirname, 'interview_assistant.db');
const db = new sqlite3.Database(dbPath);

// Beginner-friendly questions for each topic - designed for higher scores
const questionsData = {
  'JavaScript': [
    "What is JavaScript?",
    "How do you declare a variable in JavaScript?",
    "What is the difference between let and var?",
    "How do you write a comment in JavaScript?",
    "What is a function in JavaScript?",
    "How do you call a function?",
    "What is an array in JavaScript?",
    "How do you access the first element of an array?",
    "What is the length property of an array?",
    "How do you add an element to the end of an array?",
    "What is a string in JavaScript?",
    "How do you concatenate two strings?",
    "What is the typeof operator used for?",
    "What is a boolean value?",
    "How do you write an if statement?",
    "What is a for loop used for?",
    "How do you write a while loop?",
    "What is the console.log() function used for?",
    "What is an object in JavaScript?",
    "How do you access object properties?",
    "What is the difference between == and ===?",
    "How do you check if a variable is defined?",
    "What is null in JavaScript?",
    "What is undefined in JavaScript?",
    "How do you convert a string to a number?",
    "How do you convert a number to a string?",
    "What is the Math.random() function?",
    "What is the Math.floor() function?",
    "How do you find the length of a string?",
    "What is the indexOf() method used for?",
    "How do you remove the last element from an array?",
    "What is the push() method used for?",
    "What is the pop() method used for?",
    "What is the shift() method used for?",
    "What is the unshift() method used for?",
    "How do you check if an element exists in an array?",
    "What is the slice() method used for?",
    "What is the splice() method used for?",
    "How do you join array elements into a string?",
    "How do you split a string into an array?",
    "What is the toLowerCase() method used for?",
    "What is the toUpperCase() method used for?",
    "How do you round a number to the nearest integer?",
    "What is the Date object used for?",
    "How do you get the current date and time?",
    "What is the setTimeout() function used for?",
    "What is the setInterval() function used for?",
    "How do you clear a timeout?",
    "How do you clear an interval?",
    "What is the parseInt() function used for?",
    "What is the parseFloat() function used for?",
    "How do you check if a number is an integer?"
  ],
  'React': [
    "What is React?",
    "What is a component in React?",
    "How do you create a functional component?",
    "What is JSX in React?",
    "How do you render a component in React?",
    "What is the difference between props and state?",
    "How do you pass props to a component?",
    "How do you use the useState hook?",
    "What is the useEffect hook used for?",
    "How do you handle events in React?",
    "What is conditional rendering in React?",
    "How do you render a list in React?",
    "What is the key prop used for?",
    "How do you create a form in React?",
    "What is controlled vs uncontrolled input?",
    "How do you handle form submission?",
    "What is the onChange event used for?",
    "How do you update state in React?",
    "What is the onClick event used for?",
    "How do you pass functions as props?",
    "What is the children prop in React?",
    "How do you create a button in React?",
    "How do you create an input field in React?",
    "How do you create a textarea in React?",
    "How do you create a select dropdown in React?",
    "How do you create a checkbox in React?",
    "How do you create a radio button in React?",
    "What is the className prop used for?",
    "How do you add inline styles in React?",
    "What is the style prop used for?",
    "How do you create a div element in React?",
    "How do you create a span element in React?",
    "How do you create a paragraph in React?",
    "How do you create a heading in React?",
    "How do you create a link in React?",
    "What is the href attribute used for?",
    "How do you create an image in React?",
    "What is the src attribute used for?",
    "What is the alt attribute used for?",
    "How do you create a table in React?",
    "How do you create table rows and cells?",
    "What is the map() function used for in React?",
    "How do you filter an array in React?",
    "How do you sort an array in React?",
    "What is the filter() function used for?",
    "What is the sort() function used for?",
    "How do you find an element in an array?",
    "What is the find() function used for?",
    "How do you check if an element exists in an array?",
    "What is the includes() function used for?",
    "How do you add an element to an array?",
    "How do you remove an element from an array?"
  ],
  'Node.js': [
    "What is Node.js?",
    "What is npm in Node.js?",
    "How do you install a package using npm?",
    "How do you create a package.json file?",
    "What is the require() function used for?",
    "How do you import a module in Node.js?",
    "What is the module.exports used for?",
    "How do you create a simple HTTP server?",
    "What is Express.js?",
    "How do you install Express.js?",
    "How do you create an Express app?",
    "How do you define a route in Express?",
    "What is a GET request?",
    "What is a POST request?",
    "How do you handle GET requests in Express?",
    "How do you handle POST requests in Express?",
    "What is middleware in Express?",
    "How do you use the body-parser middleware?",
    "What is the app.use() function used for?",
    "How do you send a response in Express?",
    "What is res.send() used for?",
    "What is res.json() used for?",
    "What is res.status() used for?",
    "How do you set the port for your server?",
    "What is the process.env object used for?",
    "How do you access environment variables?",
    "What is the __dirname variable?",
    "What is the __filename variable?",
    "How do you read a file in Node.js?",
    "How do you write to a file in Node.js?",
    "What is the fs module used for?",
    "How do you create a directory in Node.js?",
    "How do you check if a file exists?",
    "How do you delete a file in Node.js?",
    "How do you rename a file in Node.js?",
    "What is the path module used for?",
    "How do you join file paths?",
    "How do you get the file extension?",
    "What is the url module used for?",
    "How do you parse a URL in Node.js?",
    "What is the querystring module used for?",
    "How do you parse query parameters?",
    "What is the crypto module used for?",
    "How do you create a hash in Node.js?",
    "What is the util module used for?",
    "How do you format strings in Node.js?",
    "What is the os module used for?",
    "How do you get system information?",
    "What is the process object used for?",
    "How do you get command line arguments?",
    "What is the Buffer class used for?",
    "How do you create a buffer in Node.js?",
    "What is the EventEmitter class used for?",
    "How do you create custom events?",
    "What is the Stream class used for?",
    "How do you read data from a stream?",
    "What is the Timer class used for?",
    "How do you create a timer in Node.js?"
  ],
  'Data Structures': [
    "What is an array?",
    "How do you access elements in an array?",
    "What is the index of the first element in an array?",
    "How do you find the length of an array?",
    "How do you add an element to the end of an array?",
    "How do you remove the last element from an array?",
    "How do you add an element to the beginning of an array?",
    "How do you remove the first element from an array?",
    "What is a string?",
    "How do you find the length of a string?",
    "How do you access characters in a string?",
    "How do you convert a string to uppercase?",
    "How do you convert a string to lowercase?",
    "How do you check if a string contains a word?",
    "How do you replace text in a string?",
    "What is an object?",
    "How do you access object properties?",
    "How do you add a new property to an object?",
    "How do you remove a property from an object?",
    "How do you check if an object has a property?",
    "What is a number?",
    "How do you round a number to the nearest integer?",
    "How do you round a number up to the next integer?",
    "How do you round a number down to the previous integer?",
    "How do you generate a random number?",
    "What is a boolean?",
    "What are the two boolean values?",
    "How do you check if two values are equal?",
    "How do you check if two values are not equal?",
    "How do you check if a value is greater than another?",
    "How do you check if a value is less than another?",
    "How do you check if a value is greater than or equal to another?",
    "How do you check if a value is less than or equal to another?",
    "What is a list?",
    "What is the difference between an array and a list?",
    "What is a stack?",
    "What are the main operations of a stack?",
    "What is a queue?",
    "What are the main operations of a queue?",
    "What is a set?",
    "How do you add an element to a set?",
    "How do you remove an element from a set?",
    "How do you check if an element exists in a set?",
    "What is a map?",
    "How do you add a key-value pair to a map?",
    "How do you get a value from a map?",
    "How do you remove a key-value pair from a map?",
    "What is a tree?",
    "What is the root of a tree?",
    "What are the leaves of a tree?",
    "What is a node in a tree?",
    "What is a graph?",
    "What is a vertex in a graph?",
    "What is an edge in a graph?",
    "What is a linked list?",
    "What is the difference between an array and a linked list?",
    "What is a hash table?",
    "How do you store data in a hash table?",
    "How do you retrieve data from a hash table?"
  ],
  'System Design': [
    "What is a system?",
    "What is system design?",
    "What is scalability?",
    "What is reliability?",
    "What is availability?",
    "What is a database?",
    "What is the difference between SQL and NoSQL?",
    "What is a web server?",
    "What is an API?",
    "What is REST?",
    "What is HTTP?",
    "What are HTTP methods?",
    "What is a GET request?",
    "What is a POST request?",
    "What is a PUT request?",
    "What is a DELETE request?",
    "What is a client?",
    "What is a server?",
    "What is the difference between client and server?",
    "What is a frontend?",
    "What is a backend?",
    "What is the difference between frontend and backend?",
    "What is a load balancer?",
    "What is caching?",
    "What is a CDN?",
    "What is a microservice?",
    "What is a monolithic application?",
    "What is the difference between microservices and monolithic?",
    "What is a database index?",
    "What is a primary key?",
    "What is a foreign key?",
    "What is normalization?",
    "What is denormalization?",
    "What is a session?",
    "What is authentication?",
    "What is authorization?",
    "What is the difference between authentication and authorization?",
    "What is a cookie?",
    "What is a token?",
    "What is JWT?",
    "What is OAuth?",
    "What is SSL?",
    "What is HTTPS?",
    "What is the difference between HTTP and HTTPS?",
    "What is a firewall?",
    "What is encryption?",
    "What is hashing?",
    "What is the difference between encryption and hashing?",
    "What is a backup?",
    "What is disaster recovery?",
    "What is monitoring?",
    "What is logging?",
    "What is debugging?",
    "What is testing?",
    "What is unit testing?",
    "What is integration testing?",
    "What is performance testing?",
    "What is security testing?"
  ],
  'Machine Learning': [
    "What is machine learning?",
    "What is artificial intelligence?",
    "What is the difference between AI and ML?",
    "What is supervised learning?",
    "What is unsupervised learning?",
    "What is a dataset?",
    "What is training data?",
    "What is testing data?",
    "What is a model in machine learning?",
    "What is prediction in machine learning?",
    "What is accuracy in machine learning?",
    "What is overfitting?",
    "What is underfitting?",
    "What is a feature in machine learning?",
    "What is a label in machine learning?",
    "What is classification?",
    "What is regression?",
    "What is clustering?",
    "What is a neural network?",
    "What is deep learning?",
    "What is the difference between ML and deep learning?",
    "What is a decision tree?",
    "What is a random forest?",
    "What is linear regression?",
    "What is logistic regression?",
    "What is k-means clustering?",
    "What is a support vector machine?",
    "What is natural language processing?",
    "What is computer vision?",
    "What is reinforcement learning?",
    "What is a training algorithm?",
    "What is a loss function?",
    "What is an optimizer?",
    "What is gradient descent?",
    "What is backpropagation?",
    "What is a convolutional neural network?",
    "What is a recurrent neural network?",
    "What is transfer learning?",
    "What is data preprocessing?",
    "What is feature scaling?",
    "What is data normalization?",
    "What is cross-validation?",
    "What is a confusion matrix?",
    "What is precision?",
    "What is recall?",
    "What is F1 score?",
    "What is bias in machine learning?",
    "What is variance in machine learning?",
    "What is the bias-variance tradeoff?",
    "What is ensemble learning?",
    "What is bagging?",
    "What is boosting?",
    "What is a hyperparameter?",
    "What is hyperparameter tuning?",
    "What is model evaluation?",
    "What is model deployment?"
  ]
};

// Initialize database
db.serialize(() => {
  console.log('Initializing database...');

  // Create users table
  db.run(`CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    email TEXT UNIQUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
  )`);

  // Create questions table
  db.run(`CREATE TABLE IF NOT EXISTS questions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    topic TEXT NOT NULL,
    text TEXT NOT NULL,
    difficulty TEXT DEFAULT 'beginner',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  )`);

  // Create interview_attempts table
  db.run(`CREATE TABLE IF NOT EXISTS interview_attempts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    topic TEXT NOT NULL,
    score REAL NOT NULL,
    total_questions INTEGER NOT NULL,
    correct_answers INTEGER NOT NULL,
    duration_minutes INTEGER,
    confidence_score REAL,
    facial_expression_score REAL,
    attempt_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
  )`);

  // Create question_usage table to track which questions have been used
  db.run(`CREATE TABLE IF NOT EXISTS question_usage (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    question_id INTEGER NOT NULL,
    used_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id),
    FOREIGN KEY (question_id) REFERENCES questions (id)
  )`);

  // Insert sample questions
  console.log('Inserting sample questions...');
  const insertQuestion = db.prepare('INSERT OR IGNORE INTO questions (topic, text, difficulty) VALUES (?, ?, ?)');
  
  Object.entries(questionsData).forEach(([topic, questions]) => {
    questions.forEach(question => {
      insertQuestion.run(topic, question, 'beginner');
    });
  });
  
  insertQuestion.finalize();

  console.log('Database initialization completed!');
  console.log(`Inserted ${Object.values(questionsData).flat().length} questions across ${Object.keys(questionsData).length} topics`);
});

db.close((err) => {
  if (err) {
    console.error('Error closing database:', err);
  } else {
    console.log('Database connection closed.');
  }
}); 